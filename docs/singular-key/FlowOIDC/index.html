<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/documenter/blog/rss.xml" title="ZenKey Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documenter/blog/atom.xml" title="ZenKey Docs Blog Atom Feed"><title data-react-helmet="true">FlowOIDC | ZenKey Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://myzenkey.github.io/documenter//documenter/docs/singular-key/FlowOIDC"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="FlowOIDC | ZenKey Docs"><meta data-react-helmet="true" name="description" content="TOC"><meta data-react-helmet="true" property="og:description" content="TOC"><link data-react-helmet="true" rel="shortcut icon" href="/documenter/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://myzenkey.github.io/documenter//documenter/docs/singular-key/FlowOIDC"><link data-react-helmet="true" rel="alternate" href="https://myzenkey.github.io/documenter//documenter/docs/singular-key/FlowOIDC" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://myzenkey.github.io/documenter//documenter/docs/singular-key/FlowOIDC" hreflang="x-default"><link rel="stylesheet" href="/documenter/assets/css/styles.9e49aaa5.css">
<link rel="preload" href="/documenter/assets/js/runtime~main.e4d0dd18.js" as="script">
<link rel="preload" href="/documenter/assets/js/main.49ce807f.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documenter/"><img src="/documenter/img/ZenKey_symbol_rgb.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/documenter/img/ZenKey_symbol_rgb.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ZenKey Docs</b></a><a class="navbar__item navbar__link navbar__link--active" href="/documenter/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MyZenKey/documenter/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/documenter/docs/intro">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Conceptual Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tech Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Android Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Web Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integration Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Portal User Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Singular Key</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/singular-key/FlowAPI">Singular Key Flow Integration via API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documenter/docs/singular-key/FlowOIDC">FlowOIDC</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FlowOIDC</h1></header><p><strong>TOC</strong></p><header><h1>Singular Key Flow Integration via OIDC</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="getting-started"></a>Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><p>There are several ways to invoke a Singular Key Flow - using OIDC (OpenID Connect), SAML 2.0, Web SDK (Widget), Native Mobile SDK or API.</p><p>This article documents Flow invocation via OIDC. We will first create a simple flow in Flow Studio in Singular Key Admin Portal.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="terminology"></a>Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">#</a></h2><ul><li><strong>Connector</strong>: A virtual representation of a third party service or a native Singular Key functionality within the Singular Key Orchestration Platform. It exposes a set of <strong>capabilities</strong> that can be used in flows</li><li><strong>Connection</strong>: A configured instance of a <strong>connector</strong></li><li><strong>Flow</strong>: Connections can be connected to each other to create meaningful user journeys or flows</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="creating-a-flow"></a>Creating a Flow<a class="hash-link" href="#creating-a-flow" title="Direct link to heading">#</a></h2><p>We&#x27;ll create a Hello World Flow which will Login the user using ZenKey and then create a session with a set of standard claims and redirect the user to the Relying Party redirect Url.</p><p>In order to create a ZenKey flow, you will need access to the Singular Key Admin Portal. At a high level, you need to:</p><ul><li>Register an account in the <a href="https://portal.myzenkey.com/" target="_blank" rel="noopener noreferrer">ZenKey developer portal</a></li><li>Create and configure <strong>connections</strong></li><li>Create a <strong>Flow</strong> in Flow Studio </li><li>Create an <strong>App</strong> and assign a Flow to it. </li></ul><p>We&#x27;ll walk you through the steps to create your first flow (Helloworld)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-1-log-into-singular-key-admin-portal"></a>Step 1: Log into Singular Key Admin Portal<a class="hash-link" href="#step-1-log-into-singular-key-admin-portal" title="Direct link to heading">#</a></h3><p>Use the Admin Portal URL that is provided to you during the onboarding-process. Login with the credentials provided to you</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2-create-connections"></a>Step 2: Create Connection(s)<a class="hash-link" href="#step-2-create-connections" title="Direct link to heading">#</a></h3><p>We&#x27;ll create a Http Connection (which has the capability to send a JSON response)</p><ul><li><p>ZenKey Connection</p><ul><li>Click on Connections</li><li>Click on &#x27;New Connection&#x27; button</li><li>Choose &#x27;ZenKey&#x27; Connector from the dropdown list</li><li>Click Create <ul><li>You should now see a &#x27;ZenKey&#x27; connection in your Connections list</li></ul></li><li>Now click on the newly created connection and configure its properties. <strong>Note</strong>: You will need to have registered a ZenKey developer account. </li></ul></li><li><p>Next create a &#x27;Singular Key Token Management&#x27;/&#x27;Singular Key Session&#x27; Connection</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">*  Click on Connections</span></span><span class="token-line" style="color:#212121"><span class="token plain">*  Click on &#x27;New Connection&#x27; button</span></span><span class="token-line" style="color:#212121"><span class="token plain">*  Choose &#x27;Singular Key Token Management&#x27;/&#x27;Singular Key Session&#x27; Connector from the dropdown list</span></span><span class="token-line" style="color:#212121"><span class="token plain">*  Click Create </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should now see a &#x27;Singular Key Token Management&#x27;/&#x27;Singular Key Session&#x27; connection in your Connections list</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-3-create-flow"></a>Step 3: Create Flow<a class="hash-link" href="#step-3-create-flow" title="Direct link to heading">#</a></h3><ul><li>Click on <strong>Flow Studio</strong></li><li>Click on &#x27;<strong>Create New Flow</strong>&#x27;</li><li>Enter <strong>Name of Flow</strong> and click &#x27;Create&#x27;.<ul><li>A new flow is created and you&#x27;ll be presented with a Flow Canvas</li></ul></li><li>On the <strong>Flow Canvas</strong>, click on the + icon on the bottom left corner to &#x27;<strong>add connection</strong>&#x27;.</li><li>On the Add Connection menu, select the &#x27;ZenKey&#x27; Connection. This will automatically place the ZenKey connection on the Flow Canvas.</li><li>Click on the <strong>ZenKey Connection</strong> that is on the canvas. It&#x27;ll present you with a list of supported capabilities for this connection. </li><li>Choose the &#x27;<strong>ZenKey Login</strong>&#x27; capability and click Save.<ul><li>[Optional] In the &#x27;ZenKey Login&#x27; capability, you can optionally configure a few parameters like Display Name, CSS etc</li></ul></li><li>Next, follow up the same steps to create a <strong>&#x27;Singular Key Token/Session Management&#x27;</strong> node on the canvas. Click on the node and select &#x27;Create Tokens&#x27; and hit Save.</li><li>Next,connect the two nodes to each other</li><li>Click on the &#x27;Save&#x27; button on the Canvas to <strong>Save and Deploy</strong> the flow</li></ul><p>You have <strong>successfully created your first flow</strong> that can be invoked via OIDC!
In the future iterations, we will add several nodes to do various checks like device and location policy checks or MFA Register or Authentication. The idea is that several nodes can be strung together in many different ways to create a complex set of &#x27;if these then those&#x27; sequences. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-4-create-app-and-assign-flow-to-app"></a>Step 4: Create App and Assign Flow to App<a class="hash-link" href="#step-4-create-app-and-assign-flow-to-app" title="Direct link to heading">#</a></h3><ul><li>Click on Applications on the left menu</li><li>Click on &#x27;Create New App&#x27; button</li><li>Enter app name (&#x27;HelloWorld&#x27;) and click create. You will now see the newly created app in the list</li><li>Select the newly created app. You will be presented a settings dialog box which contains several tabs. <ul><li>Take a note of the &#x27;CompanyId&#x27; and API Key in the General Tab. You will need them to invoke the flow in the later section</li></ul></li><li>Click on the Flows Tab<ul><li>Select the flow from the &#x27;Add Flow&#x27; drop down box</li><li>Click on Apply </li><li>Take note of the FlowId. </li></ul></li><li>OIDC Settings are in the OpenId Tab<ul><li><code>Client id</code></li><li><code>Client secret</code></li><li><code>Redirect Url&#x27;s</code>: Add your application callback url and hit enter and click Apply</li><li><code>Scopes</code>: supported Scopes</li><li><code>Grants</code>: supported Grants</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="invoking-a-flow-via-oidc"></a>Invoking a Flow via OIDC<a class="hash-link" href="#invoking-a-flow-via-oidc" title="Direct link to heading">#</a></h2><p>This typically involves</p><ul><li>The customer (Relying Party App) redirects the user to Singular Key Flow ODIC Authorization Url to initiate the flow</li><li>The user is taken through the flow / user journey</li><li>At the end of the flow, Singular Key redirects the user back to the customer&#x27;s Redirect Uri with the code and state parameters</li><li>The customer backend calls the Singular Key Token Url to exchange the code for the various tokens (<code>access_token</code>, <code>id_token</code>)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="api-endpoint"></a>API Endpoint<a class="hash-link" href="#api-endpoint" title="Direct link to heading">#</a></h3><p>SINGULARKEY_API_ENDPOINT</p><p><strong>Sandbox</strong>: <a href="https://devapi.singularkey.com" target="_blank" rel="noopener noreferrer">https://devapi.singularkey.com</a>
<strong>Production</strong>: <a href="https://api.singularkey.com" target="_blank" rel="noopener noreferrer">https://api.singularkey.com</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="oidc-authorization-url"></a>OIDC Authorization Url<a class="hash-link" href="#oidc-authorization-url" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token function" style="color:#aa5d00">curl</span><span class="token plain"> GET &#x27;SINGULARKEY_API_ENDPOINT/v1/auth/:companyId/flows/:flowId/authorize?</span></span><span class="token-line" style="color:#212121"><span class="token plain"></span><span class="token assign-left variable" style="color:#545454">client_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CLIENT_ID</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain"></span><span class="token assign-left variable" style="color:#545454">response_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">code</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain"></span><span class="token assign-left variable" style="color:#545454">scope</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">openid</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain"></span><span class="token assign-left variable" style="color:#545454">redirect_uri</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">REDIRECT_URI</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain"></span><span class="token assign-left variable" style="color:#545454">state</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">STATE`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="request-parameters"></a>Request Parameters<a class="hash-link" href="#request-parameters" title="Direct link to heading">#</a></h4><ul><li>[Required] <code>:companyId</code>: Singular Key Generated Unique Id for your account</li><li>[Required] <code>:flowId</code>: Singular Key Generated Unique Id for your flow</li><li>[Required] <code>CLIENT_ID</code>: client Id can be found in the Singular Key Admin Portal -&gt; Applications-&gt;Your App-&gt;General Tab </li><li>[Required]  <code>REDIRECT_URI</code>: as defined in the Singular Key Admin Portal -&gt; Applications-&gt;Your App-&gt;OpenID Tab</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="oidc-token-url"></a>OIDC Token Url<a class="hash-link" href="#oidc-token-url" title="Direct link to heading">#</a></h3><p>Upon successful execution of the flow, the last node in the flow (&#x27;Singular Key Token Management&#x27;/&#x27;Singular Key Session&#x27;) will redirect the user to the Relying Party&#x27;s Redirect Uri (as defined in the Admin Portal -&gt; Applications -&gt; Your App-&gt;OpenId Tab) with the <code>code</code> and optional <code>state</code> parameter. </p><p>Your backend application can call the Token Url to exchange the code for the tokens (<code>access_token</code>, <code>id_token</code> and <code>refresh_token</code>)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token function" style="color:#aa5d00">curl</span><span class="token plain"> POST </span><span class="token string" style="color:#008000">&#x27;API_ENDPOINT/v1/auth/:companyId/token&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain">--header </span><span class="token string" style="color:#008000">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain">--data-raw </span><span class="token string" style="color:#008000">&#x27;{</span></span><span class="token-line" style="color:#212121"><span class="token string" style="color:#008000">  &quot;client_id&quot;:&quot;CLIENT_ID&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token string" style="color:#008000">  &quot;client_secret&quot;:&quot;CLIENT_SECRET&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token string" style="color:#008000">  &quot;grant_type&quot;:&quot;authorization_code&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token string" style="color:#008000">  &quot;code&quot;:&quot;CODE&quot;  </span></span><span class="token-line" style="color:#212121"><span class="token string" style="color:#008000">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="responses"></a>Responses<a class="hash-link" href="#responses" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="success-response-fields"></a>Success Response Fields<a class="hash-link" href="#success-response-fields" title="Direct link to heading">#</a></h5><ul><li><code>access_token</code>: JWT token containing the access token which can be used to fetch user information or access the Singular Key&#x27;s self service user portal</li><li><code>token_type</code>: Bearer</li><li><code>expires_in</code>: access token&#x27;s expiry date/time</li><li><code>id_token</code>: JWT token containing ID token related claims. Claims can be customized in the flow by using Singular Key Token Management/Singular Key Session&#x27;s <code>Send Custom Claims</code> capability </li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="jwt-token-validation"></a>JWT Token Validation<a class="hash-link" href="#jwt-token-validation" title="Direct link to heading">#</a></h4><p><code>id_token</code> signature can validated using a node library like node-jose</p><p>JWKS public keys is available in the Admin Portal -&gt; Company</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json="><pre tabindex="0" class="prism-code language-json= codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">const publicKeys = {</span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;keys&quot;: [</span></span><span class="token-line" style="color:#212121"><span class="token plain">        {</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;kty&quot;: &quot;RSA&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;kid&quot;: &quot;-YtA5HbM-d1r8qUGin5P_1W1mGyJCiZObRN6QgnB_Fg&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;n&quot;: &quot;ubObDOrqzsG4LFBjMg-VBc-s39BlfyoB26LT-mKj8vNXjIo0XGXAKTxmieH5tfs3yiXk8X24P7K5KeUG_z1aS7DAHZ2qazVk4IFVdGlM4gXUfirmFsD8Y0Lyo0j8-ecyflqXa13JoZzVuox-P87qJ1jHxu_uodXVdp0JaV9JM6gz08Bus1zrh-IRfyxYgn8dADffJf_a6QFjotwfPgxr2ZmS8J1d-VZWnYJ13GFDzm0yYl4eX9x56TW0lrhnDnhEKy_Q30YLNQomhsRIe6hUYwTieuW82aS-NGK7eFF6fRz2hAhyqnu6PSk5SaZcoFbcVDYX79DBgf_OdgeBkKTTVKMDCAZpYnV6LBX-r_wopxD1da8q_-zaaYXj7p82N4NdqPYbCzSWYKlvlQ1YY64kB_rQsxZF_btXu0Wpv4qPI8j2eSx_JVo2QqtE3b9m3RcaFSuFMs9jTdHt8QaoWpefHj-D6yw4in2E96pLYROuNYP_vW4lwRMbc4A0tPPT7y0GeJq9yK4RITFfuiZUhwBliiN_NGjorJai4OXvXwKaqqLON8Kpo7g6YFmX4ACx_yrNeN-7vDY7D7eFMNhNkCzHCEECghCO6bJFw-3eFYg-gg3NctEIZaTQUrX5Bm3T-w8EQtYsY1BeFVjGC0R81b6f8nPgfNhXozZAfDamQpJTAW0&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;e&quot;: &quot;AQAB&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;alg&quot;: &quot;RS256&quot;,</span></span><span class="token-line" style="color:#212121"><span class="token plain">            &quot;use&quot;: &quot;sig&quot;</span></span><span class="token-line" style="color:#212121"><span class="token plain">        }</span></span><span class="token-line" style="color:#212121"><span class="token plain">    ]</span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">const id_token = &#x27;ID_TOKEN_FROM_TOKEN_URL_RESPONSE&#x27;</span></span><span class="token-line" style="color:#212121"><span class="token plain">const jwkResult = await jose.JWK.asKeyStore(publicKeys)</span></span><span class="token-line" style="color:#212121"><span class="token plain">const idToken = await jose.JWS.createVerify(jwkResult).verify(id_token)</span></span><span class="token-line" style="color:#212121"><span class="token plain">const claims = JSON.parse(idToken.payload)</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">// verify the token expiration</span></span><span class="token-line" style="color:#212121"><span class="token plain">const current_ts = Math.floor(new Date() / 1000)</span></span><span class="token-line" style="color:#212121"><span class="token plain">if (current_ts &gt; claims.exp) {</span></span><span class="token-line" style="color:#212121"><span class="token plain">    throw new Error(&#x27;ID Token Expired&#x27;)</span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">// verify audience matches client Id</span></span><span class="token-line" style="color:#212121"><span class="token plain">if (claims.aud != clientId) {</span></span><span class="token-line" style="color:#212121"><span class="token plain">    throw new Error(&#x27;ClientId does not match&#x27;)</span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="user-info-url"></a>User Info Url<a class="hash-link" href="#user-info-url" title="Direct link to heading">#</a></h3><p>User&#x27;s Access Token from the Token Url Response is used to authenticate to the User Info endpoint</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token function" style="color:#aa5d00">curl</span><span class="token plain"> GET </span><span class="token string" style="color:#008000">&#x27;API_ENDPOINT/v1/auth/:companyId/user&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#212121"><span class="token plain">--header </span><span class="token string" style="color:#008000">&#x27;Authorization: Bearer USER_ACCESS_TOKEN&#x27;</span><span class="token plain"> </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="response"></a>Response<a class="hash-link" href="#response" title="Direct link to heading">#</a></h5><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>userId</code></td><td>Singular Key assigned unique id to the user</td></tr><tr><td><code>username</code></td><td>RP assigned username for the user</td></tr><tr><td><code>companyId</code></td><td>Singular Key assigned unique id for the account</td></tr><tr><td><code>connectionId</code></td><td>connectionId pool to which the user is assigned</td></tr><tr><td><code>createdDate</code></td><td>timestamp when the user record was created</td></tr><tr><td><code>authType</code></td><td>Internal use</td></tr><tr><td><code>name</code></td><td>[Optional] name of the user</td></tr><tr><td><code>email</code></td><td>[Optional] user&#x27;s email address</td></tr><tr><td><code>phoneNumber</code></td><td>[Optional] user&#x27;s phone number</td></tr><tr><td><code>userAlias</code></td><td>[Optional] alias assigned to the user</td></tr><tr><td><code>mfaEnabled</code></td><td>[Optional]whether the mfa flag is true or false</td></tr><tr><td><code>credentials</code></td><td>List of user&#x27;s credentials</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="sequence-diagram"></a>Sequence Diagram<a class="hash-link" href="#sequence-diagram" title="Direct link to heading">#</a></h2><p>The sequence diagram below shows the data flow between the various components when a Flow/User Journey is invoked via OIDC. It uses a Login Flow as an example. The same pattern applies to any other flow type (enrollment, transaction, account recovery) invoked via OIDC.</p><img src="./sequenceDiagrams/SKFlowOIDC.png"></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MyZenKey/documenter/edit/main/docs/singular-key/FlowOIDC.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documenter/docs/singular-key/FlowAPI"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Singular Key Flow Integration via API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link">Getting Started</a></li><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#creating-a-flow" class="table-of-contents__link">Creating a Flow</a><ul><li><a href="#step-1-log-into-singular-key-admin-portal" class="table-of-contents__link">Step 1: Log into Singular Key Admin Portal</a></li><li><a href="#step-2-create-connections" class="table-of-contents__link">Step 2: Create Connection(s)</a></li><li><a href="#step-3-create-flow" class="table-of-contents__link">Step 3: Create Flow</a></li><li><a href="#step-4-create-app-and-assign-flow-to-app" class="table-of-contents__link">Step 4: Create App and Assign Flow to App</a></li></ul></li><li><a href="#invoking-a-flow-via-oidc" class="table-of-contents__link">Invoking a Flow via OIDC</a><ul><li><a href="#api-endpoint" class="table-of-contents__link">API Endpoint</a></li><li><a href="#oidc-authorization-url" class="table-of-contents__link">OIDC Authorization Url</a></li><li><a href="#oidc-token-url" class="table-of-contents__link">OIDC Token Url</a></li><li><a href="#user-info-url" class="table-of-contents__link">User Info Url</a></li></ul></li><li><a href="#sequence-diagram" class="table-of-contents__link">Sequence Diagram</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/intro">Welcome</a></li><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/conceptual-overview/definitions-basic-concepts">Basic Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/tech-overview/authentication-flows">Authentication Flows</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/myzenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/myzenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/zenkey/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-0FnMmgpk3bmTy1LoxRE_Q" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/MyZenKey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZenKey.</div></div></div></footer></div>
<script src="/documenter/assets/js/runtime~main.e4d0dd18.js"></script>
<script src="/documenter/assets/js/main.49ce807f.js"></script>
</body>
</html>