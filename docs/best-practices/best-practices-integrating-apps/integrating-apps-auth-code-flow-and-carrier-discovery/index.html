<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/documenter/blog/rss.xml" title="ZenKey Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documenter/blog/atom.xml" title="ZenKey Docs Blog Atom Feed"><title data-react-helmet="true">Auth Code Flow and Carrier Discovery | ZenKey Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://myzenkey.github.io/documenter//documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Auth Code Flow and Carrier Discovery | ZenKey Docs"><meta data-react-helmet="true" name="description" content="The ZenKey API exposes one main entry point, authorize, which is a function that takes a number of different parameters for further processing downstream by the ZenKey app (i.e., the carrier-specific app that supports ZenKey) or exiting with an error context."><meta data-react-helmet="true" property="og:description" content="The ZenKey API exposes one main entry point, authorize, which is a function that takes a number of different parameters for further processing downstream by the ZenKey app (i.e., the carrier-specific app that supports ZenKey) or exiting with an error context."><link data-react-helmet="true" rel="shortcut icon" href="/documenter/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://myzenkey.github.io/documenter//documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery"><link data-react-helmet="true" rel="alternate" href="https://myzenkey.github.io/documenter//documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://myzenkey.github.io/documenter//documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery" hreflang="x-default"><link rel="stylesheet" href="/documenter/assets/css/styles.9e49aaa5.css">
<link rel="preload" href="/documenter/assets/js/runtime~main.e4d0dd18.js" as="script">
<link rel="preload" href="/documenter/assets/js/main.49ce807f.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documenter/"><img src="/documenter/img/ZenKey_symbol_rgb.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/documenter/img/ZenKey_symbol_rgb.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ZenKey Docs</b></a><a class="navbar__item navbar__link navbar__link--active" href="/documenter/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MyZenKey/documenter/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/documenter/docs/intro">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Conceptual Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tech Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Android Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Web Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Best Practices</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-getting-started">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Managing and Enrolling Users</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Integrating Apps</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery">Auth Code Flow and Carrier Discovery</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-building-an-app">Building an App</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-carrier-apps">Carrier Apps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-test-your-app">Test Your App</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-trusted-browsers">Trusted Browsers</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Identity Services - Brand Integration</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-identity-service-brand-integration-guidelines">Identity service brand integration guidelines</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-integrating-apps">Integrating Apps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/best-practices-managing-and-enrolling-users">Managing and Enrolling Users</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/identity-service-brand-integration-guidelines">Identity Service Brand Integration Guidelines</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/documenter/docs/best-practices/zenkey-support">ZenKey Support</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integration Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Portal User Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Singular Key</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Auth Code Flow and Carrier Discovery</h1></header><p>The ZenKey API exposes one main entry point, <code>authorize</code>, which is a function that takes a number of different parameters for further processing downstream by the ZenKey app (i.e., the carrier-specific app that supports ZenKey) or exiting with an error context. </p><p>This section describes ZenKey&#x27;s primary and a secondary flows. Both terminate with an authorization code and a valid, ZenKey-supported <code>mccmnc</code> — a six-digit number representing the user’s mobile country code (mcc) and mobile network code (mnc) — whose value allows for SIM and user authentication. As the Service Provider, you are responsible for passing this information to your server to make a token request.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="primary-device-flow"></a>Primary Device Flow<a class="hash-link" href="#primary-device-flow" title="Direct link to heading">#</a></h2><p>Before a user can sign in to your app using ZenKey, they must first install their carrier’s version of the ZenKey app on their primary device. After completing a simple initial setup, they may use ZenKey to log in to third-party applications. Pressing the ZenKey button in a third-party app or website from their primary device starts the authentication process prompting users to set up their devices as a primary device if they have yet to do so. </p><p><strong>Note:</strong> This primary device is also the device with which users can authenticate requests from other devices, such as desktops and tablets.</p><p><img alt="Primary Device High Level Flow" src="/documenter/assets/images/b06fdf4-PrimaryDeviceHighLevelFlow-b0f95e3c0a3f7dfce25543f30908709b.jpeg"></p><ol><li>The mccmnc — a six-digit number representing the user’s mobile country code (mcc) and mobile network code (mnc) whose value allows for SIM and user authentication — determines the users&#x27; wireless carrier. The carrier returns an authorization code via your Redirect URI (see Section 4.1 Configure Your Redirect URI).</li><li>Your app or website makes an authorization code request to the local ZenKey app.</li><li>If the user consents to share information, your backend server issues a token request for user info and other resources.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="secondary-device-flow"></a>Secondary Device Flow<a class="hash-link" href="#secondary-device-flow" title="Direct link to heading">#</a></h2><p>The secondary device flow denotes the &quot;Trusted Browser Flow&quot; for users&#x27; secondary devices such as a desktop browser or tablet. In this case, users perform authorizations for your app from a web browser/secondary device on which the app is not installed alongside the ZenKey app.</p><p>When users press the ZenKey button on a secondary device, they see a visual and numeric code. This code allows users to associate that secondary device with their primary devices.</p><p><img alt="Scondary Device High Level Flow" src="/documenter/assets/images/7337ce2-Secondary-device-high-level-flow-25c4784e492f0b4b62509209bea3fdae-752a235826233aa3baed8ce30ce5d658.png"></p><ol><li>The SDK presents the carrier Discovery UI. If the user is authorizing a secondary device from an app on a tablet, the SDK uses a webview for this step.</li><li>Users then scan the visual code or enter the numeric code into the ZenKey app on their primary device.</li><li>Once users approve the request in the ZenKey app on their primary devices, the carrier Discovery UI returns a login_hint_token to your app’s Redirect URI. This login_hint_token is only returned to a secondary device for use during the authentication request.</li><li>To perform SIM and user authentication, your app makes an authorization code request to the appropriate carrier and receives the auth code in its Redirect URI.</li><li>If users consent to share information, your backend server issues a token request for user info and other resources.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="discovery"></a>Discovery<a class="hash-link" href="#discovery" title="Direct link to heading">#</a></h2><p>During discovery, your application determines the correct OpenID authentication request URL to construct. If users accessed the ZenKey application on their devices they need only perform discovery once per browser at worst, and at best only when accessing your service from their non-primary devices.</p><p>If users tried to sign in to your app or website from a new desktop browser, for instance, they need to authenticate by accessing their primary devices to verify their ZenKey identity. The discovery endpoint would then load the discovery-ui web interface where users either scan a visual code or enter a manual code on the browser into their primary devices. Once users verify their ZenKey account on a secondary device/browser, they will not be required to repeat the discovery process again for that particular device/browser.</p><p><strong>Note:</strong> To prevent fraud, users will never be asked to provide a phone number in the web interface of the discovery service page.</p><p><strong>Sample Request</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">https://discoveryui.myzenkey.com/ui/discovery-ui?%20client_id=CLIENT_ID%20&amp;redirect_uri=REDIRECT_URI%20&amp;state=STATE%20&amp;sdk_version=SDK_VERSION%20&amp;prompt=true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Sample Response</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">https://server.example.com/cb?login_hint_token=&lt;xxx&gt;&amp;mccmnc=&lt;xx&gt;&amp;state=&lt;state&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>[block:callout]
{
&quot;type&quot;: &quot;info&quot;,
&quot;body&quot;: &quot;login_hint_token is an optional parameter returned only if the request is made by a secondary device, such as a desktop browser or tablet. Requests that originate on a user&#x27;s primary device will not return this parameter. Only include login_hint_token if present in the discovery response. Do not include login_hint_token if the parameter is not present in the response.&quot;
}</p><p>For more information about discovery, see <a href="/documenter/docs/web/web-integration-options">Integration options on the web</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="authorization-code-request-universal-link-captured"></a>Authorization Code Request, Universal Link Captured<a class="hash-link" href="#authorization-code-request-universal-link-captured" title="Direct link to heading">#</a></h3><p>Once discovery is completed, your app&#x27;s SDK (Android, iOS, or JavaScript) constructs the request for the auth code. The ZenKey app on a device captures this standard OpenID Connect request which registers the universal link or is serviced by the carriers’ web interface as an alternative.</p><p><strong>Note:</strong> If users have a carrier-specific ZenKey application on their devices already, the common request will be serviced by the carrier natively or via the web. Otherwise, users are instructed to download and install the ZenKey application.</p><p>Sample Authorization Code Request</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">https://server.example.com/authorize? </span></span><span class="token-line" style="color:#212121"><span class="token plain">client_id=CLIENT_ID </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;login_hint_token=LOGIN_HINT_TOKEN </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;redirect_uri=REDIRECT_URI </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;response_type=code </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;scope=SCOPES </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;state=STATE</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="normal-authorization-code-request-vs-server-initiated-flow"></a>Normal Authorization Code Request vs. Server-Initiated Flow<a class="hash-link" href="#normal-authorization-code-request-vs-server-initiated-flow" title="Direct link to heading">#</a></h4><p>The majority of authorization code requests look a lot like the one shown directly above. However, if you configured your project for a server-initiated flow you would send a POST to the server_initiated_authorization_endpoint and receive a 200 response. This scenario differs from the regular authorization code request, which supports both GET and POST, and returns a 302 response. Another key difference for a server-initiated flow is that the response_type in your request must be set to async_token instead of code. Assuming these criteria have been met and the request contains a valid request JWT signed by you, the server-initiated response would resemble the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">HTTP/1.1 200 OK</span></span><span class="token-line" style="color:#212121"><span class="token plain">Content-type: application/json</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">{</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “correlation_id”:”123”,</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “auth_req_id”:”123325325352”,</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “expires_in”:”3600”</span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sim-and-user-authentication"></a>SIM and User Authentication<a class="hash-link" href="#sim-and-user-authentication" title="Direct link to heading">#</a></h3><p>User authentication can fail for any number of reasons. Perhaps a user gets a new SIM card, transfers their SIM card to a new device, or simply resets their device. In each scenario, a carrier detects a device_change, ZenKey might trigger a fraud alert, and a user fails to authenticate.</p><p>If, however, a user keeps their device yet changes their address, such a profile_change still allows that user to authenticate with your service. As a best practice, record your users&#x27; sub—the identifier that pairs a single user to a single application. Storing this value in a database allows you to make server-initiated calls to the carrier, instead of the phone number, and discern a device_change from a profile_change .</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="recovery-process"></a>Recovery Process<a class="hash-link" href="#recovery-process" title="Direct link to heading">#</a></h3><p>Whenever ZenKey launches on a user device, it verifies the following attributes:</p><p>Carrier User ID
IMSI: Identity of the SIM card
IMEI: Identity of the device
Application key: an application instance key for the ZENKEY application.</p><p>In the wake of a <code>device_change</code>, ZenKey triggers a recovery flow that challenges the user to provide three factors (methods) for re-associating the new attributes to users&#x27; accounts. During this process, ZenKey presents separate screens where users select the authentication method and successfully provide the requested information. </p><p>Example recovery methods include:</p><ul><li>Biometrics (fingerprints, face scans)</li><li>ZenKey PIN numbers</li><li>Email verification</li><li>Carrier login information</li><li>Single-use recovery codes</li><li>Trusted secondary devices</li></ul><p>In addition to re-associating a ZenKey user after a <code>device_change</code>, the recovery process is also beneficial for users who get locked out of their accounts. In addition, recovery is necessary for users who wish to transfer their ZenKey account from one mobile provider to another. In this last scenario, users would:</p><ol><li>Select their former carrier.</li><li>Sign in to their former carrier&#x27;s account.</li><li>Confirm their identity by providing at least three ZenKey recovery methods.</li><li>Sign in to their new carrier&#x27;s account.</li><li>Create their new ZenKey account.</li></ol><p>Once users complete these steps, ZenKey informs them that all their data was transferred to their new carrier&#x27;s account.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configuring-redirect-uris"></a>Configuring Redirect URIs<a class="hash-link" href="#configuring-redirect-uris" title="Direct link to heading">#</a></h3><p>When a user authorizes your application, the ZenKey SDK sends an authorization code request to the appropriate carrier then redirects users back to the app via your Redirect URI. This Redirect URI may also be used for callbacks to several ZenKey services.</p><p><strong>Using the Recommended Redirect URI</strong></p><p>The Redirect URI field in the <a href="https://portal.myzenkey.com/" target="_blank" rel="noopener noreferrer">ZenKey Portal</a> is pre-populated with a recommended value that starts with your Client ID, but whose value you may change to a custom Redirect URI (see section directly below).</p><p>The ZenKey mobile SDKs assume the recommended Redirect URI is included. If you change this value, you must take extra steps to integrate a custom universal link for your mobile apps. </p><p><strong>Using Multiple Redirect URIs</strong>
You may also choose to keep the recommended Redirect URI, and add additional ones. </p><p>Providing multiple Redirect URIs can be useful if you wish to use unique Redirect URIs for different environments (development vs. production, for example) or for different platforms that share the same Client ID. Additionally, you may want to receive callbacks at different URLs depending on the authorization type. </p><p>If you configure your Redirect URI in the <a href="https://portal.myzenkey.com/" target="_blank" rel="noopener noreferrer">ZenKey Portal</a>, its scheme must resemble one of the following formats:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">    - {client_id}://com.example.provider.sdk</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">    - https://URL/URI</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">    - {custom}://</span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">    - com.sp.app://</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As a general rule, you should also configure one or more valid Redirect URIs in the Redirect URIs attribute of your Client ID metadata, doing so as a space-separated list of redirects that are exact matches, with no wild-carding.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="token-request"></a>Token Request<a class="hash-link" href="#token-request" title="Direct link to heading">#</a></h3><p>As a Service Provider, you must make a token request using your registered client_id and a JWT client assertion signed by your registered keys. Because you cannot secure secrets on a mobile device, we recommend using a server instance for these requests.</p><p>To make requests directly from a mobile device, ZenKey recommends your client first secure a signed assertion from your server. The client can then use that signed assertion in the request. For more info, please refer to the key binding section of this document.</p><p>In the example below, your client has secured the auth code and passed it to your server to get the token. Here, your server must re-run discovery in order to identify the carrier&#x27;s endpoint data.</p><p><img alt="RTA mage" src="/documenter/assets/images/88aa20b-rtaImage-b01d75b5ad039f9d8477113f8792f067.jpeg"></p><p><strong>Token Request</strong> </p><p><img alt="Token Request 1" src="/documenter/assets/images/token-request-1-db07f0f1a934c395ffe47a0d0bc325bf.png">
<img alt="Token Request 2" src="/documenter/assets/images/token-request-2-7a6fc93a9153068b53ba394621676a5a.png"></p><p><strong>Sample Request</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">POST /token HTTP/1.1 </span></span><span class="token-line" style="color:#212121"><span class="token plain">Host: mno.com Authorization Basic Y2xpZW50aWQ6Y2xpZW50c2VjcmV0 </span></span><span class="token-line" style="color:#212121"><span class="token plain">Content-Type: application/x-www-form-urlencoded </span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">grant_type=authorization_code </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;redirect_uri=https://www.client.com </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;code={auth_code} </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">POST /token HTTP/1.1 </span></span><span class="token-line" style="color:#212121"><span class="token plain">Host: mno.com Authorization Basic Y2xpZW50aWQ6Y2xpZW50c2VjcmV0 </span></span><span class="token-line" style="color:#212121"><span class="token plain">Content-Type: application/x-www-form-urlencoded </span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">grant_type=authorization_code </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;redirect_uri=https://www.client.com </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;code={auth_code} </span></span><span class="token-line" style="color:#212121"><span class="token plain">&amp;code_verifier={codeVerifier}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Token Response</strong> </p><p><img alt="Token Response 1" src="/documenter/assets/images/token-response-1-e8fa31ef0849325f31993d3f3c2bba46.png">
<img alt="Token Response 2" src="/documenter/assets/images/token-response-2-1432062a61c96c093693e39060fb5686.png">
<img alt="Token Response 3" src="/documenter/assets/images/token-response-3-b7a7b13c71e4fe3023afa50d78a702c1.png"></p><p><strong>Sample Response</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">HTTP/1.1 200 OK </span></span><span class="token-line" style="color:#212121"><span class="token plain">Content-type: application/json </span></span><span class="token-line" style="color:#212121"><span class="token plain">Cache-control: no-cache </span></span><span class="token-line" style="color:#212121"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#212121"><span class="token plain">{ </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;access_token&quot;: &quot;....&quot;, </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;token_type&quot;: &quot;Bearer&quot;, </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;refresh_token&quot;: &quot;8xLOxBtZp8&quot;, </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;expires_in&quot;: 3600, </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;correlation_id”:”xxxxx”, </span></span><span class="token-line" style="color:#212121"><span class="token plain">    &quot;id_token&quot;: &quot;...&quot; </span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="userinfo"></a>Userinfo<a class="hash-link" href="#userinfo" title="Direct link to heading">#</a></h3><p>ZenKey supports capturing user information based on the user&#x27;s providing permission to you. The predefined scopes supported by ZenKey include:</p><ul><li>openid</li><li>email</li><li>name</li><li>phone</li><li>postalCode</li></ul><p>You must make a <code>userinfo</code> request using your access token to receive any of the user profile attributes. Service Providers that only need authentication or 2nd-factor authentication need not make the <code>userinfo</code> request.
The <code>userinfo_endpoint</code> extracted from the discovered carrier’s iss/.well-known/openid-configuration indicates the destination for this call.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="userinfo-request"></a>Userinfo request<a class="hash-link" href="#userinfo-request" title="Direct link to heading">#</a></h3><p>Submit a <code>userinfo</code> request using your access token to receive any of the user profile attributes. The <code>userinfo_endpoint</code> extracted from the discovered carrier’s openid-configuration identifies the destination for this call.</p><p><img alt="User info" src="/documenter/assets/images/user-info-f60d20f3367d3e591695b155a9573408.png"></p><p>Sample Request</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">GET /v1/userinfo?sdk_version=1.1 HTTP/1.1</span></span><span class="token-line" style="color:#212121"><span class="token plain">Host: mno.com</span></span><span class="token-line" style="color:#212121"><span class="token plain">Authorization: bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjEyMzQ1In0.eyJpc3MiOiJodHRwczovL3hjaWp2LnQtbW9iaWxlLmNvbSIsImlhdCI6IjE1NTI4NzU4ODIiLCJleHAiOiIxNTUyODc1ODgyIiwiYXVkIjoiY2NpZC1zcGFwcGxpY2F0aW9uMDAxIiwic3ViIjoiMzYwMjEwLTMzMnNmMjM0MzAxLTEyNDRqNDNnYmprczMzIiwiYWNyIjoiYWFsMyIsImFtciI6WyJod2siLCJmcHQiXSwiY25mIjp7Imt0eSI6IlJTQSIsIm4iOiJ3Z3c2aGs0Z1dNcUFmVS1SMnFNT1lIRHdTQ0lwYlMxY2pPTDZQRThZbXRYTTRLNU5seGgtYmVIYkZxM0Z5RjQwR256Vy16eW5wVjJYVVZOLXJ5Q0FHbVFtZEFMT1M3WkF1UV9kX2lqdlR4U3hwQjhWb3RodU41MmtmWVRwNnlwWWpJem5maVVWSFFLWFdQSFA4R0NXdzhSaHJzTzF2WHR6TEN3QVJSQ3ZrNXowMVNiVHZDTWVfQllyaDBhS0ZuMU9hWWUzSlgwM3NycDNUZGdUYl9KanVtVWdZZ1FKT3JUZkJjS1pZN1BlbWY5eDV6RUxyVjlmd0JaREotWWZoTkJGZUFvQ3o3N1VXczM4NkZqWlNJbHhwb2xWRlI2ek5jSjJ2WTBfNDhtLTJxTVpMWVpBRjItalRjZ2x2Mlo4YXVPVHM4dHU1R1hNUDEtRmtORURKcVlIMXciLCJlIjoiQVFBQiJ9fQ.czReSZPxr5BbFt68_XSSrfbpyss6k5ZgKhM1gJj9_fU</span></span><span class="token-line" style="color:#212121"><span class="token plain">x-authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOiIxNTI0ODY3NDE1IiwiZXhwIjoiMTUyNDg3MTAxNSIsImFsZyI6InNoYTI1NiIsImVodHMiOiJhdXRob3JpemF0aW9uIiwiZWR0cyI6IjZhZjNlYTlhOGIyMzdkNDQwZDIzNjdkNzQ2MmNjMmE1NjgzYmJmMjZhYjg0Y2EyMDZmNmMyY2ZkYTJhNTQ1NDIifQ.MzHzE4_IsOKe4w6JOKP21GrNqaaWomj3Y_SQzMaTGRs</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="userinfo-response"></a>Userinfo Response<a class="hash-link" href="#userinfo-response" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#212121;background-color:#F8F9FA"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#212121"><span class="token plain">{   “sub”:”mccmnc-1234567abcdefghijk”,</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “name”: {</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “value”:”Jane Doe”,</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “given_name”: “Jane”,</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “family_name”: “Doe”},</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “email”:{</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “value: “janedoe@example.com”},</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “postal_code”: {</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “value”:“90210”},</span></span><span class="token-line" style="color:#212121"><span class="token plain">    “phone”: {</span></span><span class="token-line" style="color:#212121"><span class="token plain">        “value”:“+13101234567”},  </span></span><span class="token-line" style="color:#212121"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="user-consent"></a>User Consent<a class="hash-link" href="#user-consent" title="Direct link to heading">#</a></h3><p>Because ZenKey does not provide a silent user experience (i.e., an implicit flow where the user experience is seamless across a single page) and the prompt parameter is not the same across the different carriers, users must approve a transaction with each request (referred to as explicit user consent) using the user&#x27;s primary device.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MyZenKey/documenter/edit/main/docs/best-practices/best-practices-integrating-apps/integrating-apps-auth-code-flow-and-carrier-discovery.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documenter/docs/best-practices/best-practices-managing-and-enrolling-users/managing-and-enrolling-users-register-trusted-devices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Registering Trusted Devices</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documenter/docs/best-practices/best-practices-integrating-apps/integrating-apps-building-an-app"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Building an App »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#primary-device-flow" class="table-of-contents__link">Primary Device Flow</a></li><li><a href="#secondary-device-flow" class="table-of-contents__link">Secondary Device Flow</a></li><li><a href="#discovery" class="table-of-contents__link">Discovery</a><ul><li><a href="#authorization-code-request-universal-link-captured" class="table-of-contents__link">Authorization Code Request, Universal Link Captured</a></li><li><a href="#sim-and-user-authentication" class="table-of-contents__link">SIM and User Authentication</a></li><li><a href="#recovery-process" class="table-of-contents__link">Recovery Process</a></li><li><a href="#configuring-redirect-uris" class="table-of-contents__link">Configuring Redirect URIs</a></li><li><a href="#token-request" class="table-of-contents__link">Token Request</a></li><li><a href="#userinfo" class="table-of-contents__link">Userinfo</a></li><li><a href="#userinfo-request" class="table-of-contents__link">Userinfo request</a></li><li><a href="#userinfo-response" class="table-of-contents__link">Userinfo Response</a></li><li><a href="#user-consent" class="table-of-contents__link">User Consent</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/intro">Welcome</a></li><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/conceptual-overview/definitions-basic-concepts">Basic Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/documenter/docs/tech-overview/authentication-flows">Authentication Flows</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/myzenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/myzenkey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/zenkey/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-0FnMmgpk3bmTy1LoxRE_Q" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/MyZenKey" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 ZenKey.</div></div></div></footer></div>
<script src="/documenter/assets/js/runtime~main.e4d0dd18.js"></script>
<script src="/documenter/assets/js/main.49ce807f.js"></script>
</body>
</html>